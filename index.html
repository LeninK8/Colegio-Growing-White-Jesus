<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Galer√≠a Multimedia de Alumnos</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body { margin:0; font-family: Arial, sans-serif; background: #121212; color: white; }
h1 { text-align:center; margin-top:20px; }
.seccion { margin: 30px auto; max-width: 900px; border-radius: 15px; padding:20px; background:#1e1e1e; }
.fecha { font-size: 22px; margin-bottom: 15px; color: #ccc; }
.video-principal { width: 100%; max-height: 500px; background:#000; border-radius:10px; overflow:hidden; display:flex; justify-content:center; align-items:center; }
.video-principal video { width:100%; height:auto; max-height:500px; object-fit:cover; }
.fotos { display:flex; gap:10px; overflow-x:auto; margin-top:10px; padding-bottom:10px; }
.foto { flex:0 0 auto; width:150px; height:100px; border-radius:8px; overflow:hidden; cursor:pointer; }
.foto img { width:100%; height:100%; object-fit:cover; }
.modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); display:none; justify-content:center; align-items:center; z-index:999; }
.modal-content { display:flex; width:80%; max-width:1000px; height:80%; background:#2b2b2b; border-radius:10px; overflow:hidden; }
.media { flex:3; display:flex; justify-content:center; align-items:center; background:#000; }
.media img, .media video { max-width:100%; max-height:100%; }
.info { flex:1; padding:20px; display:flex; flex-direction:column; overflow-y:auto; }
.reacciones { display:flex; flex-wrap:wrap; }
.reacciones span { font-size:24px; margin:5px; cursor:pointer; display:flex; align-items:center; }
.reacciones .contador { margin-left:5px; font-size:18px; }
.comentarios { margin-top:20px; }
.comentarios textarea { width:100%; height:60px; resize:none; background:#333; color:white; border:none; padding:10px; border-radius:5px; }
.comentarios .enviar { margin-top:10px; background:#4caf50; border:none; color:white; padding:5px 10px; border-radius:5px; cursor:pointer; }
.cerrar { position:absolute; top:10px; right:20px; font-size:30px; color:white; cursor:pointer; }
.emoji-anim { transform: scale(1.5); transition: transform 0.2s; }
</style>
</head>
<body>

<h1>Galer√≠a Multimedia de Alumnos</h1>
<div id="galeria"></div>

<div class="modal" id="modal">
  <span class="cerrar" onclick="cerrarModal()">√ó</span>
  <div class="modal-content">
    <div class="media" id="modalMedia"></div>
    <div class="info">
      <div class="reacciones" id="reaccionesDiv"></div>
      <div class="comentarios">
        <textarea id="comentarioInput" placeholder="Escribe un comentario..."></textarea>
        <button class="enviar" onclick="enviarComentario()">Enviar</button>
        <div id="listaComentarios"></div>
      </div>
    </div>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_PROJECT_ID.firebaseapp.com",
  databaseURL: "https://TU_PROJECT_ID-default-rtdb.firebaseio.com",
  projectId: "TU_PROJECT_ID",
  storageBucket: "TU_PROJECT_ID.appspot.com",
  messagingSenderId: "TU_SENDER_ID",
  appId: "TU_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>

<script>
const archivos = [
  "2025-08-01_video1.mp4",
  "2025-08-01_foto1.jpg",
  "2025-08-01_foto2.jpg",
  "2025-08-02_video1.mp4",
  "2025-08-02_foto1.jpg",
  "2025-08-02_foto2.jpg"
];

const galeria = document.getElementById('galeria');
const emojis = ['‚ù§Ô∏è','üòÇ','üòÆ','üëç'];
let currentArchivo = '';

// Agrupar por fecha
const agrupados = archivos.reduce((acc, archivo)=>{
  const fecha = archivo.split('_')[0];
  if(!acc[fecha]) acc[fecha]=[];
  acc[fecha].push(archivo);
  return acc;
}, {});

for(const fecha in agrupados){
  const seccion = document.createElement('div');
  seccion.classList.add('seccion');
  seccion.innerHTML = `<div class="fecha">${fecha}</div>`;
  
  const videos = agrupados[fecha].filter(a=>a.endsWith('.mp4'));
  const fotos = agrupados[fecha].filter(a=>a.endsWith('.jpg') || a.endsWith('.png'));
  
  if(videos.length>0){
    const vp = document.createElement('div');
    vp.classList.add('video-principal');
    vp.innerHTML = `<video src="images/${videos[0]}" controls onclick="abrirModal('${videos[0]}')"></video>`;
    seccion.appendChild(vp);
  }
  if(fotos.length>0){
    const fotosDiv = document.createElement('div');
    fotosDiv.classList.add('fotos');
    fotos.forEach(f=>{
      const fDiv = document.createElement('div');
      fDiv.classList.add('foto');
      fDiv.innerHTML = `<img src="images/${f}" onclick="abrirModal('${f}')">`;
      fotosDiv.appendChild(fDiv);
    });
    seccion.appendChild(fotosDiv);
  }
  galeria.appendChild(seccion);
}

function abrirModal(archivo){
  currentArchivo = archivo;
  const ext = archivo.split('.').pop().toLowerCase();
  const modal = document.getElementById('modal');
  const modalMedia = document.getElementById('modalMedia');
  modalMedia.innerHTML = ext==='mp4'
    ? `<video src="images/${archivo}" controls autoplay></video>`
    : `<img src="images/${archivo}">`;
  
  // Reacciones
  const reaccionesDiv = document.getElementById('reaccionesDiv');
  reaccionesDiv.innerHTML = '';
  emojis.forEach(e=>{
    const span = document.createElement('span');
    span.textContent = e;
    span.classList.add('emoji-btn');
    const countSpan = document.createElement('span');
    countSpan.classList.add('contador');
    db.ref('reacciones/'+archivo+'/'+e).once('value', snap=>{
      countSpan.textContent = snap.val()||0;
    });
    span.onclick = ()=>{
      // Animaci√≥n
      span.classList.add('emoji-anim');
      setTimeout(()=>span.classList.remove('emoji-anim'),200);
      // Incrementar en DB
      const ref = db.ref('reacciones/'+archivo+'/'+e);
      ref.transaction(val => (val||0)+1);
      countSpan.textContent = parseInt(countSpan.textContent||0)+1;
    };
    span.appendChild(countSpan);
    reaccionesDiv.appendChild(span);
  });

  // Comentarios
  mostrarComentarios();

  modal.style.display='flex';
}

// Comentarios Firebase
function enviarComentario(){
  const input = document.getElementById('comentarioInput');
  if(!input.value) return;
  const ref = db.ref('comentarios/'+currentArchivo);
  ref.push(input.value);
  input.value='';
}

function mostrarComentarios(){
  const lista = document.getElementById('listaComentarios');
  lista.innerHTML='';
  db.ref('comentarios/'+currentArchivo).on('value', snap=>{
    lista.innerHTML='';
    snap.forEach(c=>{
      const div = document.createElement('div');
      div.style.borderBottom='1px solid #444';
      div.style.padding='5px 0';
      div.textContent = c.val();
      lista.appendChild(div);
    });
  });
}

function cerrarModal(){
  document.getElementById('modal').style.display='none';
  document.getElementById('modalMedia').innerHTML='';
  document.getElementById('comentarioInput').value='';
  currentArchivo='';
}
</script>
</body>
</html>
